{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="{% static 'myapp/img/apple-icon.png' %}">
    <link rel=" icon" type="image/png" href="{% static 'myapp/img/favicon.png' %}">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>
        Welcome to DivyaBhaskar Dashboard
    </title>
    <meta content='width=device-width, initial-scale=1.0, shrink-to-fit=no' name='viewport' />
    <!--     Fonts and icons     -->
    <link rel="stylesheet" type="text/css"
        href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
    <!-- CSS Files -->

    <link href="{% static 'myapp/css/material-dashboard.css' %}" rel="stylesheet" />
    <link href="{% static 'myapp/css/style.css' %}" />



    <!--data table css-->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.1/css/jquery.dataTables.css">
    <!--calander css-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css">


</head>

<!--datatable CSS -->
<style>
    .tables {
        background-color: rgb(156, 3, 156);
    }

    .tables>thead>tr>th {
        border-bottom-width: 0;
        color: #181616;
        text-align: center;

    }

    .tables>tbody td {
        padding: 10px 15px 10px 18px;
        color: #0b0c0b;
        font-size: 15px;
        font-weight: normal;
        word-break: break-word;
        border-color: rgb(15, 15, 15);
        text-align: center;
        vertical-align: middle;

    }

    .tables>tbody>tr:nth-child(even) {
        background: #0999a3;
    }
</style>


<body class="">

    <div class="wrapper">
        <div class="sidebar" data-color="purple" data-background-color="white"
            data-image="{% static 'myapp/img/sidebar-1.jpg' %}">

            <div class="logo"><a href="/" class="simple-text logo-normal">
                    Jignesh
                </a></div>
            <div class="sidebar-wrapper">
                <ul class="nav">
                    <li class="nav-item active ">
                        <a class="nav-link" href="{% url 'dashboard' %}">
                            <i class="material-icons">dashboard</i>
                            <p>Dashboard</p>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a class="nav-link" href="{% url 'user_profile' %}">
                            <i class="material-icons">person</i>
                            <p>User Profile</p>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a class="nav-link" href="{% url 'state' %}">
                            <i class="material-icons">content_paste</i>
                            <p>State</p>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a class="nav-link" href="{% url 'city' %}">
                            <i class="material-icons">library_books</i>
                            <p>City</p>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a class="nav-link" href="{% url 'area' %}">
                            <i class="material-icons">bubble_chart</i>
                            <p>Area</p>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a class="nav-link" href="{% url 'user' %}">
                            <i class="material-icons">location_ons</i>
                            <p>User</p>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a class="nav-link" href="">
                            <i class="material-icons">notifications</i>
                            <p>Notifications</p>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a class="nav-link" href="">
                            <i class="material-icons">language</i>
                            <p>Permissions</p>
                        </a>
                    </li>

                </ul>

            </div>
        </div>

        <div class="main-panel">


            <!-- Navbar -->
            <nav class="navbar navbar-expand-lg navbar-transparent navbar-absolute fixed-top ">
                <div class="container-fluid">
                    <div class="navbar-wrapper">
                        <a class="navbar-brand" href="javascript:;"></a>
                        <style>
                            .alert {
                                padding: 20px;
                                background-color: hsl(120, 92%, 20%);
                                color: white;
                            }


                            .alert_error {
                                padding: 20px;
                                background-color: hsl(0, 90%, 43%);
                                color: white;
                            }

                            .closebtn {
                                margin-left: 15px;
                                color: white;
                                font-weight: bold;
                                float: right;
                                font-size: 22px;
                                line-height: 20px;
                                cursor: pointer;
                                transition: 0.3s;
                            }

                            .closebtn:hover {
                                color: black;
                            }
                        </style>

                        {% if messages %}
                        <ul class="messages">
                            {% for msg in messages %}
                            {% if msg.tags == 'success' %}
                            <div class="alert">
                                <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
                                <strong>{{msg}}</strong>
                            </div>
                            {% elif msg.tags == 'error' %}
                            <div class="alert_error">
                                <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
                                <strong>{{msg}}</strong>
                            </div>
                            {% endif %}
                            {% endfor %}
                        </ul>
                        {% endif %}
                    </div>


                    <div class="collapse navbar-collapse justify-content-end">
                        <form class="navbar-form">
                            <div class="input-group no-border">
                                <input type="text" class="form-control" placeholder="Search...">
                                <button type="submit" class="btn btn-white btn-round btn-just-icon">
                                    <i class="material-icons">search</i>
                                    <div class="ripple-container"></div>
                                </button>
                            </div>
                        </form>
                        <ul class="navbar-nav">

                            <li class="nav-item dropdown">
                                <a class="nav-link" href="javascript:;" id="navbarDropdownProfile"
                                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <i class="material-icons">person</i>
                                    <p class="d-lg-none d-md-block">
                                        Account
                                    </p>
                                </a>
                                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownProfile">
                                    {% if request.session.email %}
                                    <a class="dropdown-item" href="{% url 'logout' %}">Logout
                                        {{request.session.fname}}</a>
                                    {% else %}
                                    <a class="dropdown-item" href="{% url 'admin_login' %}">Login</a>
                                    <div class="dropdown-divider"></div>
                                    {% endif %}
                                </div>

                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
            <!-- End Navbar -->
            <br>
            <br>

            <div class="container-fluid">


                <form name="customer" id="form1" method="POST" action="">

                    <h5 style="color:chocolate; font-weight:400;">State</h5>

                    {% for i in records %}
                    <input type="checkbox" id="state" class="state" value="{{ i }}" name="state[]">
                    <label for="scales{{ i }}" style="color: #000;font-weight:500;">{{i}}</label>
                    {% endfor %}

                    <h5 style="color: chocolate;font-weight:400;">City</h5>
                    <div id="cityHolder" style="color: #000;font-weight:500;">
                    </div>


                    <h4 style="color: chocolate; font-weight:400;">Customer Rg.Date</h4>
                    <p style="color:black; font-weight:400;">From Date: <input type="text" id="my_date_picker"
                            name="fdate"></p>
                    <p style="color:black; font-weight:400;">To Date: &nbsp;&nbsp;&nbsp;&nbsp;<input type="text"
                            id="my_date_picker1" name="tdate">
                    </p>

                    <input type="button" class="btn btn-success" id="btnedit" value="Submit">

                </form>

            </div>


            <table id="table_id" border="1" class="tables">

                <thead id="theads">
                    <tr>

                        <th style="width: 100px;display:'';" id="fname">First Name</th>
                        <th style="width: 100px;display:'';" id="mobileh">Mobile</th>
                        <th style="width: 100px;display:'';" id="stateh">State</th>
                        <th style="width: 100px;display:none;" id="cityh">City</th>
                        <th style="width: 100px;display:'';" id="ordern">Order No.</th>
                        <th style="width: 100px;display:'';" id="orderd">Order date</th>
                        <th style="width: 100px;display:'';" id="orderp">Order Price</th>
                        <th style="width: 100px;display:'';" id="productn">Product Name</th>
                        <th style="width: 100px;display:'';" id="productp">Product Price</th>


                    </tr>

                </thead>
                <tbody class="tbody">


                </tbody>
            </table>

        </div>







        <!-- JS Files -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

        <!--calander js-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
        <!--datatable js-->
        <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.1/js/jquery.dataTables.js">
        </script>
        <!--datatable sum js-->



        <script>
            $(document).ready(function () {

                $('#table_id').DataTable({


                });


                $('#my_date_picker').datepicker({
                    dateFormat: 'yy-mm-dd'
                });

                $('#my_date_picker1').datepicker({
                    dateFormat: 'yy-mm-dd'
                });


                $('.state').change(function () {
                    output = "";

                    let stateLst = []
                    $('.state:checked').each(function () {
                        stateLst.push($(this).val());
                    });

                    $.ajax({
                        url: "{% url 'get_city' %}",
                        method: "POST",
                        data: {
                            'state[]': stateLst
                        },
                        success: function (resp) {
                            x = resp.data;
                            if (resp.status == 'save') {
                                for (i = 0; i < x.length; i++) {
                                    output += `
                                
                                            <input type="checkbox" class="city" id="city${x[i].city}" value="${x[i].city}">
                                            <label for="city ${x[i].city}"> ${x[i].city }
                                            </label>
                                        `;

                                }
                                $('#cityHolder').html(output);

                            }

                            if (resp.data == 0) {
                                alert("No data found in Table")
                            }
                        }
                    });
                });


                $('#btnedit').click(function () {
                    $('#table_id').DataTable().destroy();

                    output = "";
                    let stateLst = []
                    $('.state:checked').each(function () {
                        stateLst.push($(this).val());
                    })

                    let cityLst = []
                    $('.city:checked').each(function () {
                        cityLst.push($(this).val());

                    })

                    $('#my_date_picker').datepicker();
                    let fdt = $("#my_date_picker").val();

                    $('#my_date_picker1').datepicker();
                    let tdt = $("#my_date_picker1").val();


                    $.ajax({
                        url: "{% url 'get_data' %}",
                        method: 'POST',
                        data: {
                            'state[]': stateLst,
                            'city[]': cityLst,
                            'fdate': fdt,
                            'tdate': tdt

                        },
                        success: function (resp) {
                            x = resp.data
                            if (resp.status == 'save') {
                                $('#table_id theads').html(`
                                        <tr>
                                            <th style="width: 100px;display:'';" id="fname"></th>
                                            <th style="width: 100px;display:'';" id="mobileh"></th>
                                            <th style="width: 100px;display:'';" id="stateh"></th>
                                            <th style="width: 100px;display:none;" id="cityh"></th>
                                            <th style="width: 100px;display:'';" id="ordern"></th>
                                            <th style="width: 100px;display:'';" id="orderd"></th>
                                            <th style="width: 100px;display:'';" id="orderp"></th>
                                            <th style="width: 100px;display:'';" id="productn"></th>
                                            <th style="width: 100px;display:'';" id="productp"></th>
                                            
                                        </tr>                                               
                                                                                                                 
                                    `);

                                // for column sum of order price and product price
                                var order_price = 0
                                var product_price = 0
                                var state = ''

                                for (i = 0; i < x.length; i++) {

                                    order_price += parseInt(x[i].order_price)
                                    product_price += parseInt(x[i].product_price)
                                    console.log(order_price)



                                    if (state == '') {

                                        output += ` 

                                            <tr>
                                                <td style="width: 100px;display:'';" id="fname">${x[i].fname}</td>                                          
                                                <td style="width: 100px;display:'';" id="mobileh">${x[i].mobile}</td>
                                                <td style="width: 100px;display:'';" id="stateh">${x[i].state}</td>                                                                                    
                                                <td style="width: 100px;display:none;" class="cityh">${x[i].city}</td>
                                                <td style="width: 100px;display:'';" id="ordern">${x[i].order_number}</td>
                                                <td style="width: 100px;display:'';" id="orderd">${x[i].order_date}</td>
                                                <td style="width: 100px;display:'';" id="orderp">${x[i].order_price}</td>
                                                <td style="width: 100px;display:'';" id="productn">${x[i].product_name}</td>
                                                <td style="width: 100px;display:'';" id="productp">${x[i].product_price}</td>

                                            </tr>                                                                   
                                            
                                            `;
                                    }

                                    if (state == x[i].state) {

                                        output += ` 
                                    
                                            <tr>
                                                <td style="width: 100px;display:'';" id="fname">${x[i].fname}</td>                                          
                                                <td style="width: 100px;display:'';" id="mobileh">${x[i].mobile}</td>
                                                <td style="width: 100px;display:'';" id="stateh">${x[i].state}</td>                                            
                                                <td style="width: 100px;display:none;" class="cityh">${x[i].city}</td>
                                                <td style="width: 100px;display:'';" id="ordern">${x[i].order_number}</td>
                                                <td style="width: 100px;display:'';" id="orderd">${x[i].order_date}</td>
                                                <td style="width: 100px;display:'';" id="orderp">${x[i].order_price}</td>
                                                <td style="width: 100px;display:'';" id="productn">${x[i].product_name}</td>
                                                <td style="width: 100px;display:'';" id="productp">${x[i].product_price}</td>
                
                                            </tr>
                                                                                                        
                                            `;

                                    } else(state !== x[i].state)
                                    output += `
                                        <tr>
                                            <td style="width:100px;display:'';"></td>    
                                            <td style="width:100px;display:'';"></td>    
                                            <td style="width:100px;display:'';"></td>    
                                            <td style="width:100px;display:'';"></td>    
                                            <td style="width:100px;display:'';"></td>    
                                            <td style="width:100px;display:'';"></td>    
                                            <td style="width:100px;display:'';"></td>    
                                            <td style="width:100px;display:'';"></td>                                                                                     
                                            <td style="width:100px;display:'';">${order_price}</td>
                                        </tr>
                                    
                                    `;


                                    state = x[i].state
                                }


                                $('.tbody').html(output);

                                $('#table_id').DataTable();

                            } else {
                                alert("No Data Found in Table")
                            }

                            if (cityLst.length != 0) {
                                $('#cityh,.cityh').css('display', '');
                            } else {
                                $('#cityh,.cityh').css('display', 'none');
                            }

                        }

                    });

                });
            });
        </script>

        <script src="{% static 'myapp/js/main.js' %}"></script>

</body>

</html>